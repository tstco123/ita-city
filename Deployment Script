#!/bin/bash
# deployment/deploy.sh

echo "ðŸš€ Starting iTA-City Deployment..."

# Check environment
if [ -z "$NODE_ENV" ]; then
    export NODE_ENV=production
fi

echo "ðŸ“¦ Environment: $NODE_ENV"

# Install dependencies
echo "ðŸ“¥ Installing dependencies..."
npm ci --only=production

# Run database migrations
echo "ðŸ”„ Running database migrations..."
npm run db:migrate

# Seed initial data for Mashhad
echo "ðŸŒ± Seeding initial data for Mashhad..."
npm run db:seed -- --city=mashhad

# Build frontend
echo "ðŸ”¨ Building frontend..."
npm run build

# Start application
echo "ðŸš€ Starting iTA-City application..."

if [ "$NODE_ENV" = "production" ]; then
    pm2 start ecosystem.config.js
